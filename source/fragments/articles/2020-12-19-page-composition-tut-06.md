<!--
template: tutorialpage
title: "Advanced Page Composition And Collections: Part 3) 249 Detail Pages"
appendToTarget: true
category: tutorials
tag: tutorial
articleTitle: "Advanced Page Composition And Collections: Part 3) 249 Detail Pages"
activeHeaderItem: 3
socialMediaMetaTags:
- "<meta name=\"twitter:card\" content=\"summary_large_image\">"
- "<meta name=\"twitter:site\" content=\"@gettriossg\">"
- "<meta name=\"twitter:creator\" content=\"@jefftschwartz\">"
- "<meta property=\"og:type\" content=\"article\">"
- "<meta property=\"og:url\" content=\"https://gettriossg.com/blog/tutorials/2020/12/19/page-composition-tut-06/\">"
- "<meta property=\"og:title\" content=\"Advanced Page Composition And Collections: Part 3) 249 Detail Pages\">"
- "<meta property=\"og:description\" content=\"In this multipart tutorial you will learn how to use Trio's advanced page composition along with its collections feature to create a catalog of the flags of the world website.\">"
- "<meta property=\"og:image\" content=\"https://gettriossg.com/media/composite.png\">"
-->

<img data-trio-link src="/media/composite.png" alt="a web page composition abstract">

<!-- end -->

## Prerequisites

Before proceeding with this tutorial, please familiarize yourself with Trio's <a data-trio-link href="/docs/v5/coreconcepts/">Core Concepts</a>, <a data-trio-link href="/docs/v5/tagbasedcallbacks/"> Tag-Based Callbacks</a>, <a data-trio-link href="/docs/v5/metadata/">Metadata</a>, and <a data-trio-link href="/docs/v5/collections/">Collections</a>.

## Intention Of This Tutorial

In this tutorial we will discuss the use case for Trio collections and use a collection to generate the 249 flag detail pages for our Flags Of The World Site.

## Collections Overview

Collections are groups of pages that are dynamically generated by Trio that we would otherwise have to manually create ourselves.

Take our Flags Of The World website that we are developing as part of this tutorial series for example, it includes a landing page that lists all 249 flags of the word. Information about each flag is maintained in a file named root/source/data/world.json. Now we'd like to create a detail page for every flag of the world and render those pages when one clicks on one of the flags on the site's landing page.

Without collections, you would have to manually create one fragment for each flag detail page. If there were only a few flags then that wouldn't be too difficult. However, there are 249 flags and imagine how tedious that would be if we had to manually create and maintain all of them.

That's where collections come to the rescue; they do all the "heavy lifting" for you. You only need to create one _fragment_ whose front matter declares one _collection filter function_ that when called by Trio returns a _collection dataset_, which is an array that contains one _collection dataset item_ for each flag. Trio will then create a "clone" of that fragment _in memory_ for every collection dataset item and will expose the collection dataset item's properties for that cloned fragment to tag-based callbacks via the callback's _asset_ argument, specifically as the _asset.collection_ property.</p>

## Collection Datasets

Collection datasets are _arrays of collection dataset items_ that <a href="#collection-filter-functions">collection filter functions</a> return. Each collection dataset item in a collection dataset represents a single page of the collection. The total number of collection dataset items in a collection dataset determines the total number of pages that Trio will generate for the collection.

## Collection Dataset Item Properties

Each collection dataset item in a collection dataset must include the following properties:

* pageName

The name that will be used for the page, which may also include a path.

Trio uses the value that you assign to _pageName_ for generating the path in the _root/source/fragments/_ folder that the "cloned" fragment would be located in if it were actually written to disk. This allows Trio to treat the _in memory only "cloned" fragment_ as if it actually was a physical file.

Trio uses the following algorithm to generate the path: _path to the fragment in which the collection is declared_ + _collectionDatasetItem.pageName_ + _the file name extension of the fragment (either .html or .md) in which the collection is declared_.

* data

The data that is intended to be exposed to the composite's <a href="#tag-based-callbacks">tag-based callbacks</a>, which can be accessed to add dynamic content to the page. Using the Flags Of The World website for an example, the _data_ property would be assigned a single item from the _root/source/data/world.json_ file.

You can add your own _custom properties_ to collection dataset items and they will be accessible in the composite's tag-based callbacks also.

## Create The Template Project Asset

In the project's _root/source/templates_ folder, create a new __template file__ named _country.html_ and copy and paste the following markup into that file:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="/scripts/main.js"></script>
</head>
<body>
    <main data-trio-fragment data-trio-callback="country" class="flag-country">
        <h1 class="flag-country__page-title">Flags Of The World</h1>
    </main>
</body>
</html>
```

Please notice that the above template project asset contains a single tag (in this case, a "main" tag) that is decorated with the data-trio-fragment attribute. When Trio finds such a tag decorated with this attribute in a template it will target it with any content it finds in the associated fragment. This isn't required if the fragment isn't contributing any content of its own.

Also, please notice that the same "main" tag is decorated with the data-trio-callback attribute and that it is assigned the name of the tag-based callback (see below), "country", which is located in the root/source/callbacks folder.

## Create The Fragment Project Asset

In the project's _root/source/fragments/country_ folder, first delete the _.gitkeep_ file, and then create a new __fragment file__ named _country.html_ and copy and paste the following into that:

```html
<!--
template: country
title:  Map |
appendToTarget: true
collection:
    filterFn: countryFilter
-->
<h2 class="flag-country__name"></h2>
<div class="flag-country__flag-container"></div>
<div class="flag-country__alpha2-code"></div>
<div class="flag-country__alpha3-code"></div>
<a id="catalog-link" href="/"><p class="flag-country__catalog-link">Return To Catalog</p></a>
```

Please notice how the above fragment project asset declares front matter at the very top of the file, in which it defines:

1. The required front matter property _template_ with the name of the template file it is associated with.
1. The optional front matter property _title_ with the title to be assigned to the generated document's title tag.
1. The optional front matter property _appendToTarget_ which Trio uses to determine if it should append to or replace the tag in the template that is decorated with the data-trio-fragment attribute with the fragment's content. By assigning true, Trio will append whatever content it finds in the associated fragment to this tag.
1. The optional front matter property _collection_ which is a hash with a key of "filterFn" which is assigned the name of the filter function, which in this case is _countryFilter.js_, that resides in the _source/filters_ folder (the _.js_ file type is assumed so it isn't necessary to include it).

## The JSON File

In the starter project's _root/source/data_ folder you will find the _world.json_ file, which is an array of 249 items which contain the data for each flag of the world. The following is only a very small sample of the actual file:

```JSON
[
{"id":4,"name":"Afghanistan","alpha2":"af","alpha3":"afg","img":"af.png"},
{"id":248,"name":"Ã…land Islands","alpha2":"ax","alpha3":"ala","img":"ax.png"},
{"id":8,"name":"Albania","alpha2":"al","alpha3":"alb","img":"al.png"},
{"id":12,"name":"Algeria","alpha2":"dz","alpha3":"dza","img":"dz.png"},
.
.
.
]
```

The following describes the key: value pairs of the items in the file:

* "id" - a number, the _unique id_ of the item
* "name" - a string, the _geographical location that this items flags pertains_ to, also used to sort the file in ascending "name"  order
* "alpha2" - a string, the _2 character code_ for the flag and its geographical location
* "alpha3" - a string, the _3 character code_ for the flag and its geographical location
* "img" - a string, the path to the flag's _.png_ image residing in the site's media/flags/128x128/ folder

## Create the Collection Filter Function
In the project's _root/source/filters_ folder, first delete the _.gitkeep_ file, and then create a new __javascript file__ named _countryFilter.js_ and copy and paste the following into that:

```javascript
module.exports = ({ site }) =>
    site.dataCatalog.world.map(country =>
        ({ data: country, pageName: country.name }));
```

The above collection filter function maps each country record in the _root/source/data/world.json_ file, which it accesses via _site.dataCatalog.world_, to a collectionDatasetItem by:
1. Assigning the whole country record to the collectionDatasetItem's _data_ property.
2. Assigning the country name to the collectionDatasetItem's _name_ property.

## Create The Tag-Based Callback

In the project's _root/source/callbacks_ folder, create a new __javascript file__ named _country.js_ and copy and paste the following into that:

```js
/*
dataDependencies: world
*/
module.exports = ({ $tag, $page, asset }) => {
    $page("title").append(" " + asset.collection.data.name);
    $tag.find("h2.flag-country__name").append(asset.collection.data.name);
    $tag.find("div.flag-country__flag-container").append(`
        <img class="flag-country__flag"
        src="/media/flags/128x128/${asset.collection.data.alpha2}.png"
        alt=" flag of ${asset.collection.data.name}">
    `);
    $tag.find("div.flag-country__alpha2-code").append(`
        <span class="flag-country__label">ISO 3166-1 Alpha2 Code:</span> ${asset.collection.data.alpha2}
    `);
    $tag.find("div.flag-country__alpha3-code").append(`
        <span class="flag-country__label">ISO 3166-1 Alpha3 Code:</span> ${asset.collection.data.alpha3}
    `);
};
```

When fragments declare collections, Trio will pass all the properties in the collectionDatasetItem to each tag-based callback it finds in the composite via the tag-based callback's _asset_ argument, specifically by way of the _asset.collection_ property.

The tag-based callback above uses the _asset.collection.data_ property, which references the record from the root/source/data/world.json file that the collection filter function assigned to the collectionDatasetItem's data property, to format the HTML and content required by the page.

## Build And Run The Project

Now that we have composed our intended 249 detail pages using a template, a fragment, data from a JSON file, a collection filter function, and a tag-based callback, we are ready to __build__ our site and __render__ the site in the browser. In your terminal application, please run the following commands from the root folder of your project:

```shell
trio build; trio serve
```

If you prefer, you can use the abbreviated forms of these commands instead:

```shell
trio b; trio s
```

The _build_ command instructs Trio to do a one-off build of your site _for development_ and to place the site's generated output into the project's _public/_ folder. The _serve_ command instructs Trio to serve the project's _public/_ folder's content in the browser.

Now that we have implemented the 249 detail flag pages using a collection, please click on any one of the flags listed in the landing page to render its detail page which, depending on the flag you clicked on, will look similar to the following:

<img data-trio-link src="/media/tutorials/composition/fotwdetailpage.png" alt="image of Flags Of The World detail page">

You can also view the content of any of the generated HTML documents for the detail pages, which reside in the _public/country_ folder by simply opening one in your editor of choice. Let's take a look at the one for _Virgin Islands (U.S.)_ now:

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Map | Virgin Islands (U.S.)</title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="/scripts/main.js"></script>
</head>

<body>
    <main data-trio-fragment data-trio-callback="country" class="flag-country">
        <h1 class="flag-country__page-title">Flags Of The World</h1>
        <h2 class="flag-country__name">Virgin Islands (U.S.)</h2>
        <div class="flag-country__flag-container">
            <img class="flag-country__flag" src="/media/flags/128x128/vi.png" alt=" flag of Virgin Islands (U.S.)">
        </div>
        <div class="flag-country__alpha2-code">
            <span class="flag-country__label">ISO 3166-1 Alpha2 Code:</span> vi
        </div>
        <div class="flag-country__alpha3-code">
            <span class="flag-country__label">ISO 3166-1 Alpha3 Code:</span> vir
        </div>
        <a id="catalog-link" href="/">
            <p class="flag-country__catalog-link">Return To Catalog</p>
        </a>
    </main>
</body>

</html>
```

From the above we can see that the tag-based callback _root/source/callbacks/country.js_ declared by the _&lt;main&gt;_ tag that is decorated with the _data-trio-callback_ attribute in the template

```html
<main data-trio-fragment data-trio-callback="country" class="flag-country">
```
was called and that it did dynamically generate the flag details from the individual items in the _root/source/data/world.json_ file and appended them as content to the _&lt;main&gt;_ tag.

## Conclusion

This tutorial concludes our examination of Trio's advanced page composition with collections and demonstrates how we can _dynamically generate HTML documents from metadata_, such as from the root/source/data/world.json file used in this tutorial.

We really hope that you have enjoyed all the tutorials in this series on Page Composition with Trio as much as we have had making them. Please consider a small donation to this project (see below) so that we can continue to bring you similar quality content.
