<!--
template: docpage
title: Collections - Trio
appendToTarget: true
activeHeaderItem: 2
activeDocIndexItem: 16
-->
<h1>Collections</h1>

<p><mark>Introduced in v2.0.0</mark></p>

<blockquote class="note-important"><p>After upgrading to v2 please delete the <em>root/.cache/stats.json</em> file before building your projects for the first time.</p></blockquote>

<p>Collections are groups of pages that are dynamically generated by Trio that you would otherwise have to manually create yourself.</p>

<p>As an example, let's imagine that you have a team website which includes a page that lists all the team members. Information about each team member is maintained in a file named <em>/source/data/team.json</em>. You would now like to create a detail page for every team member and render those pages when someone clicks on one of the team members in the list.</p>

<p>Without collections, you would have to manually create one fragment for each team member's detail page. If there are only a few team members that wouldn't be too difficult. But suppose there are dozens of team members! Having to manually create and maintain all those fragments would quickly become a burden. <mark>That's where collections come to the rescue; they do all the "heavy lifting" for you. You only need to create one <a href="#collection-fragments">fragment</a> for all those pages and one collection <a href="#collection-filter-functions">filter function</a> and Trio will create a "clone" of that fragment for every member of the team</mark>.</p>

<h2>Data</h2>

<p>You can use any data source, such as the data exposed by the <a href="/docs/v1/metadata">global metadata</a> </em>  <em>site</em> object, which exposes numerous collections of data that Trio has assembled for your site, or even data hard coded in a collection's <a href="#filter-functions">filter function</a>, to create the pages in your collections.</p>

<h2 id="collection-fragments">Implementing Collection Fragments</h2>
<p>To create a collection, add a <em>collection</em> hash to a fragment's front matter and assign the name of a filter function located in the <em>/source/filters</em> folder to the collection's required <em>filterFn</em> property.</p>

<figure>
<pre><code class="html">&lt;!--
template: default
title: Member |
appendToTarget: true
<mark>collection:
    filterFn: member</mark>
--&gt;

&lt;div <mark>data-trio-callback="teamMember"</mark>&gt;
    &lt;h1&gt;&lt;u&gt;Team Member&lt;/u&gt;&lt;/h1&gt;
    &lt;h2 id="name"&gt;Name: &lt;/h2&gt;
    &lt;h2 id="title"&gt;Title: &lt;/h2&gt;
    &lt;p id="bio"&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;a href="/"&gt;Main Page&lt;/a&gt;</code></pre>
<figcaption>Team Member Fragment Used To Generate A Collection Example</figcaption>
</figure>

<blockquote class="note-tip"><p>You can also add <em>custom properties</em> to the collection hash which will be accessible in your collection's filter function.</p></blockquote>

<blockquote class="note-tip"><p>Collections are always treated as <em>stale</em> and therefore do not need to be marked with <em>alwaysBuild</em>.</p></blockquote>

<h2 id="collection-filter-functions">Implementing Collection Filter Functions</h2>
<p>Each module must export a single function which, when called by Trio, is passed a single argument</p>
<pre><code>{ collection, site }</code></pre>
<p>which can be <em>destructured</em></p>
<pre><code>({ collection, site })</code></pre>
<p> to access its properties. See <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Unpacking_fields_from_objects_passed_as_function_parameter">Unpacking fields from objects passed as function parameter </a> for more information.</p>

<blockquote class="note-important"><p>Filter functions are called <em>synchronously</em>.</p></blockquote>
<figure>
<pre><code class="javascript">module.exports = ({ <mark>site</mark>, <mark>collection</mark> }) =>
    site.dataCatalog.team.map(<mark>item</mark> =>
        ({ <mark>pageName</mark>: `${item.firstName} ${item.lastName}`, <mark>item</mark> }));</code></pre>
<figcaption>Filter Function Example</figcaption>
</figure>

<h2>Filter Function Argument Properties</h2>

<h3>site</h3>
<p>site exposes the organized collection of <a href="/docs/v1/metadata"><em>metadata</em></a> that Trio creates from your project's assets. Its catalogs - <a href="/docs/v1/metadata#frags">frags</a>, <a href="/docs/v1/metadata#articles-catalog">articlesCatalog</a>, <a href="/docs/v1/metadata#categories-catalog">categoriesCatalog</a>, <a href="/docs/v1/metadata#tags-catalog">tagsCatalog</a>, <a href="/docs/v1/metadata#data-catalog">dataCatalog</a> - as well as it other properties can all be used to create a collection.</p>

<h3>collection</h3>
<p>collection is a reference to the fragment's front matter collection hash.</p>

<h2>Filter Functions Return An Array Of Data Objects</h2>

<p>Collection filter functions should return an array containing <em>one data object for each page in the collection</em>. Each data object requires the following properties:</p>
<h3>pageName</h3>
<p>The <em>name of the page</em>.</p>
<h3>item</h3>
<p>The data item that the composite's <em>tag-based callbacks</em> (see <a href="#tag-based-callbacks">Tag-Based Callbacks</a> below) will use to add dynamic content to the page.</p>
<blockquote class="note-tip"><p>You can also add <em>custom properties</em> to each collection object in the array and they will also be accessible in the composite's tag-based callbacks.</p></blockquote>

<h2 id="tag-based-callbacks">Tag-Based Callbacks</h2>

<p>In tag-based callbacks for collection pages, the <em>asset.collection</em> property exposes the following properties:</p>

<h3>item</h3>
<p>The data item associated with this collection item.</p>

<h3>pageName</h3>
<p>The name of this page associated with this collection item.</p>

<h3>index</h3>
<p>The zero-based index of this collection item.</p>

<h3>totalItems</h3>
<p>The total number of collection items.</p>

<blockquote class="note-tip"><p>In addition to the above properties, any custom properties that were added to the collection object in the filter function are also accessible.</p></blockquote>

<figure>
<pre><code class="javascript">module.exports = ({ $tag, $page, <mark>asset</mark> }) => {
    const item = <mark>asset.collection</mark>.item;
    $page("title").append(` ${item.firstName} ${item.lastName}`);
    $tag.find("#page-title").append(` #${<mark>asset.collection</mark>.index + 1}`);
    $tag.find("#name").append(`${item.firstName} ${item.lastName}`);
    $tag.find("#title").append(asset.collection.item.title);
    $tag.find("#bio").append(asset.collection.item.bio);</code></pre>
<figcaption>/source/callbacks/teamMember.js Tag-Based Callback Function Example</figcaption>
</figure>

<h2>Demo</h2>

<p>A demo collections project is available on Github that you can copy, build, run and examine.</p>

<ul>
    <li><a target="_blank" href="https://github.com/4awpawz/team-members-colloection">Demo Collections Repo</a></li>
    <li><a target="_blank" href="https://4awpawz.github.io/team-members-colloection-pages/">Demo Collections Live</a></li>
</ul>

<h2>See Also</h2>

<ul>
    <li><a data-trio-link href="/docs/v1/metadata">Metadata</a></li>
    <li><a data-trio-link href="/docs/v1/fragment">Fragment</a></li>
    <li><a data-trio-link href="/docs/v1/tagbasedcallbacks">Tag-Based Callbacks</a></li>
</ul>
