<!--
template: docpage
title: Collections - Trio
appendToTarget: true
activeHeaderItem: 2
activeDocIndexItem: 18
-->
<h1>Collections</h1>

<p><mark>Introduced in v2.0.0</mark></p>

<blockquote class="note-important"><p>The schema for the <em>cache</em> has changed for v2.0.0, and <em>is incompatible with prior versions</em>. Therefore, if you are upgrading your projects from v1 to v2, you will have to regenerate your project's cache, which you can do by running the following <em>build command</em> in the terminal:</p><pre><code class="shell">$ trio build | b</code></pre></blockquote>

<p>Collections are groups of pages that are dynamically generated by Trio that you would otherwise have to manually create yourself.</p>

<p>As an example, let's imagine that you have a team website which includes a page that lists all the team members. Information about each team member is maintained in a file named <em>root/source/data/team.json</em>. You would now like to create a detail page for every team member and render those pages when someone clicks on one of the team members in the list.</p>

<p>Without collections, you would have to manually create one fragment for each team member's detail page. If there are only a few team members then that wouldn't be too difficult. Suppose, however, there are dozens of team members and how tedious it would be to have to manually create and maintain all those fragments.<p>

<p>That's where collections come to the rescue; they do all the "heavy lifting" for you. You only need to create one <a href="#collection-fragments">fragment</a>, and one collection <a href="#collection-filter-functions">filter function</a> that returns a <a href="#collection-datasets">collection dataset</a> and Trio will create a "clone" of that fragment for every member of the team.</p>

<h2 id="collection-fragments">Implementing Collection Fragments</h2>
<p>To create a collection, add a <em>collection hash</em> to a fragment's front matter and assign its <em>filterFn</em> property the name of a filter function located in the <em>/source/filters</em> folder.</p>

<figure>
<pre><code class="html">&lt;!--
template: default
title: Member |
appendToTarget: true
<mark>collection:
    filterFn: member</mark>
--&gt;

&lt;div <mark>data-trio-callback="teamMember"</mark>&gt;
    &lt;h1&gt;&lt;u&gt;Team Member&lt;/u&gt;&lt;/h1&gt;
    &lt;h2 id="name"&gt;Name: &lt;/h2&gt;
    &lt;h2 id="title"&gt;Title: &lt;/h2&gt;
    &lt;p id="bio"&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;a href="/"&gt;Main Page&lt;/a&gt;</code></pre>
<figcaption>Example: Fragment Used To Generate A Collection</figcaption>
</figure>

<blockquote class="note-tip"><p>You can also add <em>custom properties</em> to the collection hash which will be accessible in your collection's filter function.</p></blockquote>

<blockquote class="note-tip"><p>Collections are always treated as <em>stale</em> and therefore do not need to be marked with <em>alwaysBuild</em>.</p></blockquote>

<h2 id="collection-datasets">Collection Datasets</h2>

<p>Collection datasets are arrays of objects that <a href="#collection-filter-functions">collection filter functions</a> return. Each item in a collection dataset represents a single page of the collection. The total number of items in a collection dataset determines the total number of pages that Trio will generate for the collection. Each item in a collection dataset must include the following properties:</p>

<h3>pageName</h3>
<p>The name that will be used for the page.</p>
<h3 id="a-single-item-of-data">[a single item of data]</h3>
<p>The data that the composite's <a href="#tag-based-callbacks">tag-based callbacks</a> will use to add dynamic content to the page.</p>
<blockquote class="note-important"><p>You can name this property anything you want as long as it adheres to JavaScript's object property naming conventions.</p></blockquote>
<blockquote class="note-tip"><p>You can use any of the data that is exposed by the <a href="/docs/v3/metadata#site">metadata site</a> object.</p></blockquote>
<blockquote class="note-tip"><p>You can add your own <em>custom properties</em> to the items in a collection dataset and they will be accessible in the composite's tag-based callbacks.</p></blockquote>

<h2 id="collection-filter-functions">Implementing Collection Filter Functions</h2>
<p>Each module must export a single function which, when called by Trio, is passed a single argument</p>
<pre><code>{ collection, site }</code></pre>

<p>which can be <em>destructured</em> (see <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Unpacking_fields_from_objects_passed_as_function_parameter">Unpacking fields from objects passed as function parameter </a> for more information)</p>
<pre><code>({ collection, site })</code></pre>
<p> to access its properties:</p>
<h3>site</h3>
<p>site exposes the organized collection of <a href="/docs/v3/metadata#site">metadata</a> that Trio creates from your project's assets. Its catalogs - <a href="/docs/v3/metadata#frags">frags</a>, <a href="/docs/v3/metadata#articles-catalog">articlesCatalog</a>, <a href="/docs/v3/metadata#categories-catalog">categoriesCatalog</a>, <a href="/docs/v3/metadata#tags-catalog">tagsCatalog</a>, <a href="/docs/v3/metadata#data-catalog">dataCatalog</a> - as well as its other properties can all be used to create a collection dataset.</p>
<h3>collection</h3>
<p>collection is a reference to the fragment's front matter's <a href="#collection-fragments">collection hash</a>.</p>

<blockquote class="note-important"><p>Filter functions are called <em>synchronously</em>.</p></blockquote>

<figure>
<pre><code class="javascript">module.exports = ({ <mark>site</mark>, <mark>collection</mark> }) =>
    site.dataCatalog.team.map(<mark>item</mark> =>
        ({ <mark>pageName</mark>: `${item.firstName} ${item.lastName}`, <mark>item</mark> }));</code></pre>
<figcaption>Example: Filter Function Returning A Collection Dataset</figcaption>
</figure>

<h2>Importing Uncached Internal Module Dependencies</h2>

<p>When your filter functions have their own internal module dependencies, you should import those dependencies using <a target="_blank" href="https://www.npmjs.com/package/import-fresh"><em>import-fresh</em></a> (or some similar package) to guarantee that you are always importing fresh, uncached copies of them and they reflect your most recent changes.</p>

<figure>
<pre><code class="JavaScript"><mark>const importFresh = require('import-fresh');</mark>
<mark>const pageName = importFresh("./lib/pageName");</mark>
module.exports = ({ site, collection }) =>
    site.dataCatalog.team.map(item =>
        ({ pageName: `${<mark>pageName</mark>(item.firstName, item.lastName)}`, item }));</code></pre>
<figcaption>Example: Filter Function Importing Uncached Module Dependency</figcaption>
</figure>

<h2 id="tag-based-callbacks">Tag-Based Callbacks</h2>

<p>In tag-based callbacks for collection pages, the <a href="/docs/v3/metadata#collection">asset.collection</a> property exposes the following properties:</p>

<h3>[a single item of data]</h3>
<p>The data item associated with this collection item.</p>
<p>See <a href="#a-single-item-of-data">[a single item of data]</a> above.</p>

<h3>pageName</h3>
<p>The name of this page associated with this collection item.</p>

<h3>index</h3>
<p>The zero-based index of this collection item.</p>

<h3>totalItems</h3>
<p>The total number of collection items.</p>

<blockquote class="note-tip"><p>In addition to the above properties, any custom properties that you added to the items in the collection dataset are also accessible.</p></blockquote>

<figure>
<pre><code class="javascript">module.exports = ({ $tag, $page, <mark>asset</mark> }) => {
    const item = <mark>asset.collection</mark>.item;
    $page("title").append(` ${item.firstName} ${item.lastName}`);
    $tag.find("#page-title").append(` #${<mark>asset.collection</mark>.index + 1}`);
    $tag.find("#name").append(`${item.firstName} ${item.lastName}`);
    $tag.find("#title").append(asset.collection.item.title);
    $tag.find("#bio").append(asset.collection.item.bio);</code></pre>
<figcaption>Example: /source/callbacks/teamMember.js Tag-Based Callback Function</figcaption>
</figure>

<h2>Demo</h2>

<p>A demo collections project is available on Github that you can copy, build, run and examine.</p>

<ul>
    <li><a target="_blank" href="https://github.com/4awpawz/team-members-collection">Demo Collections Repo</a></li>
    <li><a target="_blank" href="https://4awpawz.github.io/team-members-collection-pages/">Demo Collections Live</a></li>
</ul>

<h2>See Also</h2>

<ul>
    <li><a data-trio-link href="/docs/v3/metadata">Metadata</a></li>
    <li><a data-trio-link href="/docs/v3/fragment">Fragment</a></li>
    <li><a data-trio-link href="/docs/v3/tagbasedcallbacks">Tag-Based Callbacks</a></li>
</ul>
